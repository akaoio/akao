id: "akao:meta:rule_validator:v1"
description: "Meta-rule that validates all AKAO rule definitions"
version: "1.0.0"
author: "AKAO System"
category: "meta-validation"

# This meta-rule validates that all rule YAML files are properly structured
logic:
  forall:
    variable: "rule_file" 
    domain:
      function: "filesystem.get_files"
      argument:
        literal: "rules"
    condition:
      operator: "and"
      left:
        function: "has_extension"
        arguments:
          - var: "rule_file"
          - literal: ".yaml"
      right:
        operator: "and"
        left:
          # Rule file must have required fields
          function: "logic.is_well_formed"
          argument:
            function: "filesystem.read_file"
            argument: 
              var: "rule_file"
        right:
          # Rule must pass its own unit tests
          function: "test.passes"
          argument:
            function: "filesystem.read_file"
            argument:
              var: "rule_file"

# Self-validation: This meta-rule must validate itself
self_validation:
  logic:
    operator: "and"
    left:
      # This rule must have proper structure
      function: "has_field"
      arguments:
        - literal: 
            id: "akao:meta:rule_validator:v1"
            description: "Meta-rule that validates all AKAO rule definitions"
            logic: {}
            self_validation: {}
        - literal: "logic"
    right:
      # This rule must apply to itself
      function: "test.passes"
      argument:
        literal:
          function: "logic.is_well_formed"
          argument:
            get_field:
              object:
                literal:
                  id: "akao:meta:rule_validator:v1"
                  logic: {}
              field: "logic"

unit_tests:
  - name: "meta_rule_structure_valid"
    setup:
      mock_context:
        rule_files: 
          - "rules/structure/one_class_per_file.yaml"
          - "rules/testing/coverage_enforcement.yaml"
    expected:
      status: "pass"
      message: "All rule files have valid structure"
      
  - name: "validates_sample_rule"
    setup:
      mock_context:
        sample_rule_content: |
          id: "test_rule"
          logic:
            function: "test.passes"
            argument:
              literal: true
          self_validation:
            logic:
              literal: true
    expected:
      status: "pass"
      message: "Sample rule validates correctly"

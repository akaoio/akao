# CMakeLists.txt for Integration Test Suite
cmake_minimum_required(VERSION 3.16)

project(AkaoIntegrationTests 
    VERSION 1.0.0
    DESCRIPTION "Comprehensive integration test suite for Akao architectural reformation"
    LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Include directories
include_directories(${CMAKE_CURRENT_SOURCE_DIR})
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/../core)
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/../interfaces)

# Integration Test Framework
add_library(akao_integration_framework STATIC
    integration/integration_test_suite.cpp
    integration/integration_test_suite.hpp
)

# Performance Benchmark Framework (header-only, create dummy source)
file(WRITE ${CMAKE_CURRENT_BINARY_DIR}/performance_dummy.cpp "// Dummy source file for header-only library")
add_library(akao_performance_framework STATIC
    ${CMAKE_CURRENT_BINARY_DIR}/performance_dummy.cpp
    performance/performance_benchmark_framework.hpp
)

# Transformation Validation Framework (header-only, create dummy source)
file(WRITE ${CMAKE_CURRENT_BINARY_DIR}/transformation_dummy.cpp "// Dummy source file for header-only library")
add_library(akao_transformation_framework STATIC
    ${CMAKE_CURRENT_BINARY_DIR}/transformation_dummy.cpp
    transformation/transformation_validation_suite.hpp
)

# Main Integration Test Runner
add_executable(akao_integration_test_runner
    integration_test_runner.cpp
)

# Link libraries
target_link_libraries(akao_integration_test_runner
    akao_integration_framework
    akao_performance_framework
    akao_transformation_framework
)

# Compiler flags
target_compile_options(akao_integration_test_runner PRIVATE
    -Wall -Wextra -Wpedantic
    -O2
    $<$<CONFIG:Debug>:-g -DDEBUG>
    $<$<CONFIG:Release>:-DNDEBUG>
)

# Enable testing
enable_testing()

# Add integration tests
add_test(NAME EndToEndWorkflowTest
    COMMAND akao_integration_test_runner end_to_end_workflow
    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})

add_test(NAME PerformanceBenchmarkTest
    COMMAND akao_integration_test_runner performance_benchmark
    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})

add_test(NAME TransformationValidationTest
    COMMAND akao_integration_test_runner transformation_validation
    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})

add_test(NAME ComprehensiveIntegrationTest
    COMMAND akao_integration_test_runner comprehensive
    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})

# Test properties
set_tests_properties(EndToEndWorkflowTest PROPERTIES
    TIMEOUT 300
    LABELS "integration;workflow")

set_tests_properties(PerformanceBenchmarkTest PROPERTIES
    TIMEOUT 600
    LABELS "integration;performance")

set_tests_properties(TransformationValidationTest PROPERTIES
    TIMEOUT 180
    LABELS "integration;validation")

set_tests_properties(ComprehensiveIntegrationTest PROPERTIES
    TIMEOUT 900
    LABELS "integration;comprehensive")

# Custom targets
add_custom_target(run_integration_tests
    COMMAND ${CMAKE_CTEST_COMMAND} --output-on-failure --label-regex "integration"
    DEPENDS akao_integration_test_runner
    COMMENT "Running comprehensive integration test suite")

add_custom_target(run_performance_tests
    COMMAND ${CMAKE_CTEST_COMMAND} --output-on-failure --label-regex "performance"
    DEPENDS akao_integration_test_runner
    COMMENT "Running performance benchmark tests")

# Install targets
install(TARGETS akao_integration_test_runner
    DESTINATION bin
    COMPONENT integration_tests)

install(FILES 
    integration/integration_test_suite.hpp
    performance/performance_benchmark_framework.hpp
    transformation/transformation_validation_suite.hpp
    DESTINATION include/akao/tests
    COMPONENT integration_tests)

# Package configuration
set(CPACK_PACKAGE_NAME "AkaoIntegrationTests")
set(CPACK_PACKAGE_VERSION "1.0.0")
set(CPACK_PACKAGE_DESCRIPTION "Akao Integration Test Suite")
set(CPACK_PACKAGE_CONTACT "akao-dev@example.com")
include(CPack)
